<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë¶„ì‹¤ë¬¼ ê²Œì‹œíŒ</title>
<style>
body { font-family: sans-serif; margin: 20px; font-size: 16px; }
#list, #detail { display: none; }
.item { border:1px solid #ccc; padding:10px; margin-bottom:10px; cursor:pointer; }
#detail img { max-width:300px; cursor:pointer; }
#overlay {
  display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.9); justify-content:center; align-items:center;
}
#overlay img { max-width:90%; max-height:90%; }
#overlay button {
  position:absolute; top:20px; right:20px; font-size:24px;
  background:rgba(255,255,255,0.7); border:none; border-radius:50%; width:40px; height:40px; cursor:pointer;
}
.chat-box { border-top:1px solid #ccc; margin-top:10px; padding-top:10px; }
.chat-msg { border-bottom:1px solid #eee; padding:5px; }
</style>
</head>
<body>

<h1>ë¶„ì‹¤ë¬¼ ê²Œì‹œíŒ</h1>
<div>
  <button onclick="showList()">ë¶„ì‹¤ë¬¼ ëª©ë¡</button>
  <button onclick="newIssue()">ë¶„ì‹¤ë¬¼ ë“±ë¡</button>
</div>

<div id="list">
  <h2>ë¶„ì‹¤ë¬¼ ëª©ë¡</h2>
  <div id="itemList"></div>
</div>

<div id="detail">
  <h2 id="detailTitle"></h2>
  <p id="detailBody"></p>
  <img id="detailImage" src="">
  <div class="chat-box">
    <h3>ì±„íŒ…</h3>
    <div id="chatList"></div>
    <input id="chatInput" placeholder="ë©”ì‹œì§€ ì…ë ¥">
    <button onclick="sendChat()">ë³´ë‚´ê¸°</button>
  </div>
</div>

<div id="overlay">
  <img id="overlayImg">
  <button onclick="closeOverlay()">âœ•</button>
</div>

<script>
const owner = "your-username";     // ğŸ”¸ ë³¸ì¸ ê¹ƒí—ˆë¸Œ ID
const repo  = "lostfound";         // ğŸ”¸ ì €ì¥ì†Œ ì´ë¦„
const apiBase = `https://api.github.com/repos/${owner}/${repo}`;
const itemList = document.getElementById('itemList');
let currentIssueNumber = null;

async function loadList() {
  const res = await fetch(`${apiBase}/issues?state=open`);
  const issues = await res.json();
  itemList.innerHTML = "";
  issues.forEach(issue => {
    const div = document.createElement('div');
    div.className = "item";
    div.innerHTML = `<strong>${issue.title}</strong><br>${issue.body.substring(0,80)}...`;
    div.onclick = ()=>showDetail(issue.number);
    itemList.appendChild(div);
  });
}

function showList() {
  document.getElementById('list').style.display = 'block';
  document.getElementById('detail').style.display = 'none';
  loadList();
}

function newIssue() {
  // ì´ìŠˆ ìƒˆë¡œ ë“±ë¡ (prefilled)
  const url = `https://github.com/${owner}/${repo}/issues/new?title=${encodeURIComponent("ë¶„ì‹¤ë¬¼ ì œëª© ì…ë ¥")}&body=${encodeURIComponent("ë¶„ì‹¤ë¬¼ ë‚´ìš©ê³¼ ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”.")}`;
  window.open(url, "_blank");
}

async function showDetail(number) {
  currentIssueNumber = number;
  document.getElementById('list').style.display = 'none';
  document.getElementById('detail').style.display = 'block';

  // ìƒì„¸ ë‚´ìš© ë¶ˆëŸ¬ì˜¤ê¸°
  const issue = await fetch(`${apiBase}/issues/${number}`).then(r=>r.json());
  document.getElementById('detailTitle').innerText = issue.title;
  document.getElementById('detailBody').innerHTML = issue.body.replace(/\n/g,'<br>');

  // ë³¸ë¬¸ì—ì„œ ì´ë¯¸ì§€ URL ì¶”ì¶œ (ìˆì„ ë•Œë§Œ)
  const imgMatch = issue.body.match(/https?:\/\/\S+\.(jpg|jpeg|png|gif)/i);
  if (imgMatch) {
    const img = document.getElementById('detailImage');
    img.src = imgMatch[0];
    img.style.display = 'block';
  } else {
    document.getElementById('detailImage').style.display = 'none';
  }

  // ì±„íŒ…(ëŒ“ê¸€) ë¶ˆëŸ¬ì˜¤ê¸°
  loadComments(number);
}

async function loadComments(number) {
  const res = await fetch(`${apiBase}/issues/${number}/comments`);
  const comments = await res.json();
  const chatDiv = document.getElementById('chatList');
  chatDiv.innerHTML = "";
  comments.forEach(c => {
    const d = document.createElement('div');
    d.className = 'chat-msg';
    d.textContent = `${c.user.login}: ${c.body}`;
    chatDiv.appendChild(d);
  });
}

async function sendChat() {
  const msg = document.getElementById('chatInput').value.trim();
  if (!msg) return;
  alert("âš ï¸ ì‹¤ì œ ëŒ“ê¸€ ì €ì¥ì€ GitHub API POST ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.\n(ì—¬ê¸°ì„œëŠ” ì˜ˆì‹œë¡œë§Œ ì‘ë™)");
  // ì‹¤ì œ ì €ì¥í•˜ë ¤ë©´ GitHub Tokenì„ ì‚¬ìš©í•´ POST /issues/{number}/comments í˜¸ì¶œ
  document.getElementById('chatInput').value = '';
}

document.getElementById('detailImage').onclick = function(){
  document.getElementById('overlay').style.display='flex';
  document.getElementById('overlayImg').src=this.src;
};
function closeOverlay(){
  document.getElementById('overlay').style.display='none';
}

showList();
</script>
</body>
</html>
